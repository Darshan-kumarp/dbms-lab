CREATE TABLE PUBLISHER (
NAME VARCHAR (18) PRIMARY KEY, 
ADDRESS VARCHAR (10),
PHONE VARCHAR (10));

CREATE TABLE BOOK (
BOOK_ID INTEGER PRIMARY KEY,
TITLE VARCHAR (20),
PUBLISHER_NAME VARCHAR (20) REFERENCES PUBLISHER(NAME)ON DELETE CASCADE,
PUB_YEAR INT (4));

CREATE TABLE BOOK_AUTHORS (
BOOK_ID INTEGER REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, AUTHOR_NAME VARCHAR (20),
PRIMARY KEY(BOOK_ID));


CREATE TABLE LIBRARY_BRANCH( 
            BRANCH_ID INTEGER PRIMARY KEY,
             BRANCH_NAME VARCHAR(18), 
           ADDRESS VARCHAR(15));


CREATE TABLE BOOK_COPIES (
BOOK_ID INTEGER REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, 
BRANCH_ID INTEGER REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
NO_OF_COPIES INTEGER, PRIMARY KEY (BOOK_ID, BRANCH_ID));



CREATE TABLE BOOK_LENDING (
BOOK_ID INTEGER REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, 
BRANCH_ID INTEGER REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE,
CARD_NO INTEGER, 
DATE_OUT DATE, 
DUE_DATE DATE, PRIMARY KEY (BOOK_ID, BRANCH_ID, CARD_NO));

INSERT INTO PUBLISHER VALUES('PEARSON','BANGALORE','9875462530'); 
INSERT INTO PUBLISHER VALUES('MCGRAW','NEWDELHI','7845691234'); 
INSERT INTO PUBLISHER VALUES('SAPNA','BANGALORE','7845963210');


INSERT INTO BOOK VALUES(1111,'SE','PEARSON',2005); 
INSERT INTO BOOK VALUES(2222,'DBMS','MCGRAW',2004);
INSERT INTO BOOK VALUES(3333,'ANOTOMY','PEARSON',2010); 
INSERT INTO BOOK VALUES(4444,'ENCYCLOPEDIA','SAPNA',2010);


INSERT INTO	BOOK_AUTHORS VALUES(1111,'SOMMERVILLE');
INSERT INTO	BOOK_AUTHORS VALUES(2222,'NAVATHE');
INSERT INTO	BOOK_AUTHORS  VALUES(3333,'HENRY GRAY');
INSERT INTO	BOOK_AUTHORS VALUES(4444,'THOMAS');



INSERT	INTO	LIBRARY_BRANCH	VALUES(11,'CENTRAL TECHNICAL','MG ROAD');
INSERT	INTO	LIBRARY_BRANCH	VALUES(22,'MEDICAL','BH ROAD');
INSERT	INTO	LIBRARY_BRANCH	VALUES(33,'CHILDREN','SS PURAM');
INSERT	INTO	LIBRARY_BRANCH	VALUES(44,'SECRETARIAT','SIRAGATE');
INSERT	INTO	LIBRARY_BRANCH	VALUES(55,'GENERAL','JAYANAGAR');



INSERT INTO	BOOK_COPIES	VALUES(1111,11,5);
INSERT	INTO	BOOK_COPIES	VALUES(3333,22,6);
INSERT	INTO	BOOK_COPIES	VALUES(4444,33,10);
INSERT	INTO	BOOK_COPIES	VALUES(2222,11,12);
INSERT	INTO	BOOK_COPIES	VALUES(4444,55,3);
	


INSERT	INTO	BOOK_LENDING	VALUES(2222,11,1, '2017-01-10','2017-08-20');
INSERT	INTO	BOOK_LENDING	VALUES(3333,22,2, '2017-07-09','2017-08-12');
INSERT	INTO	BOOK_LENDING	VALUES(4444,55,1, '2017-04-11','2017-08-09');
INSERT	INTO	BOOK_LENDING	VALUES(2222,11,5, '2017-08-09','2017-08-19');
INSERT	INTO	BOOK_LENDING	VALUES(4444,33,1, '2017-06-08','2017-08-15');
INSERT	INTO	BOOK_LENDING	VALUES(1111,11,1, '2017-05-12','2017-06-10');
INSERT	INTO	BOOK_LENDING	VALUES(3333,22,1, '2017-07-10','2017-07-15');

sql queries........................................................................................

1]
select b.book_id, b.title, b.publisher_name, ba.author_name, bc.branch_id, bc.no_of_copies
from book b
natural join book_authors ba
natural join book_copies bc;


2]
SELECT CARD_NO FROM BOOK_LENDING WHERE DATE_OUT BETWEEN '2017-01-01' AND '2017'GROUP BY CARD_NO HAVING COUNT(*) > 3;

3]
DELETE FROM BOOK WHERE BOOK_ID = '3333';

4]
CREATE VIEW V_PUBLICATION AS SELECT BOOK_ID, TITLE, PUBLISHER_NAME,PUB_YEAR FROM BOOK ORDER BY PUB_YEAR;

5]
create view available_books as
    select b.book_id, b.title, l.branch_id, bc.no_of_copies
    from book b
    natural join book_copies bc
    natural join library_branch l;

select * from available_books;

